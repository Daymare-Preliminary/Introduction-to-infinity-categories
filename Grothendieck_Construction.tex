\section{Grothendieck Construction}

The reference for this section is \cite[B.1.2, B.1.3]{Elephant_JOH02}.

Let $ A $ be a small 1-category, $ X \colon A^{ \op } \to \Set $ a presheaf.

Recall: 
The category of elements of $ X $ is the category 
$ \int^A X $ with 
\begin{itemize}
	\item 
	objects given by tuples $ ( a \in A , x \in X ( a ) ) $,
	
	\item 
	morphisms given for another tuple $ ( b \in A , y \in X ( b ) ) $
	by a morphism $ f \colon a \to b$ such that $ f^* ( y ) = x $. 
\end{itemize}

\begin{exmp}	
	Consider $ \int^A \Hom_A (- , b ) $.
	The objects are given as $ ( a \in A , x \colon a \to b ) $ 
	and for a second tuple $ ( a' \in A , y \colon a' \to b ) $
	we have morphisms given $ f \colon a \to a' $ such that $ f^* ( y ) = x = y \circ f $.
\end{exmp}

\begin{exmp}	
	Let $ \int^{ A \times A^{ \op }} \Hom_A ( - , - ) $ be the twisted arrow category of $ A $.
	\begin{itemize}
		\item 
		The objects are given as $ ( ( a , b ) \in  A \times A^{\op}, x \colon a \to b ) $,
		
		\item 
		the morphisms are given by tuples $ ( f , g ) $, where $ f \colon a \to a' , g \colon b' \to b $ such that the following square commutes
		\[
		\begin{tikzcd}	
			a'
			\ar[r, " y " ]
			&
			b'
			\ar[d, " g "]
			\\
			a 
			\ar[ u , " f" ]
			\ar[r, " x" ]
			&
			b
		\end{tikzcd}
		\]
		for all objects $ ( ( a' , b' ) \in A \times A^{ \op } , y \colon a' \to b' ), ( ( a , b ) \in A \times A^{ \op }, x \colon a \to b )$.
	\end{itemize}

	Consider the functor $ \Set_* \xrightarrow{ v } \Set $ where $ \Set_* $ is the category of pointed sets.
	We can also construct the category of elements of $ X $ as the following pullback
	
	\[
	\begin{tikzcd}
		A
		\ar[r, " X^{ \op } "]
		&
		\Set^{ \op }
		\\
		\int^A X \cong \mathcal{ X }
		\ar[u , " p " ]
		\ar[r]
		&
		( Set_* )^{ \op }
		\ar[u, " v^{ \op } "]
	\end{tikzcd}
	\]
	
	the objects of the pullback are given as $ \mathcal{ X } = ( a \in A , ( X_a, x \in X_a )) $
	with morphisms $ f\colon a \to b $ such that $ f^* ( y ) = x $ for another object $ ( b \in B , ( X_b , y \in X_b ))$, thus we have the same objects as in the Grothendieck construction, just with the additional, but redundant data, of $ X_a $.
\end{exmp}


\begin{thm}
	The functor $ \int^A \colon \Fun ( A^{ \op } , \Set ) \to \Cat/A $ is fully faithful,
	its essential image consists of the discrete Grothendieck fibrations, i.e. those functors 
	$ \mathcal{ X } \xrightarrow{ p } A $ such that $ \forall x \in \mathcal{ X } $ and $ \forall f \colon a \to b = p ( y) $ there exists a unique $ \varphi \colon x \to y  $ such that $ p( \varphi ) = f $.
\end{thm} 

\begin{Idea}
	Let $ \mathcal{ X } \xrightarrow{ p } Y $ be a discrete Grothendieck fibration of some presheaf $ X \colon A^{ \op } \to \Set $, then we have a pullback square
	\[
	\begin{tikzcd}
		\mathcal{ X }_a 
		\ar[r]
		\ar[d]
		&
		\mathcal{ X }
		\ar[d, " p"]
		\\
		\mathds{ 1 }
		\ar[r]
		&
		A
	\end{tikzcd}
	\]
	where the objects of $ \mathcal{ X }_a $ are given by $ x \in \mathcal{ X } $ such that $ p ( x ) = a $ and morphisms $ \varphi $ such that $ p ( \varphi ) = \id_a $.
	
	
	Uniqueness of lifts yields that $ X \colon A ^{ \op } \to \Set $ is well defined.
\end{Idea}

\begin{defi}
\label{Grothendieck_constr_defi}
	The \textbf{Grothendieck construction} of a 2-functor $ X \colon A^{ \op } \to \underline{\Cat} $ is the 1-category $ \int^A X $ with objects $ ( a \in A , x \in X_a ) $ and for another object $ ( b \in B , y \in X_b )$ morphisms are given by tuples $ ( f , \varphi ) $ such that $ f \colon a \to b $ and $ \varphi \colon x \to f^* ( y ) $.
	
	The composition law in $ \int^A X $ is given as follows
	\[
	\begin{tikzcd}	
		&
		( b \in A , y \in X_b )
		\ar[rd, "{ ( g , \psi ) }"]
		&
		\\
		(a \in A , x \in X_a )
		\ar[ru, "{ ( f , \varphi ) }"]
		\ar[rr, "{ ( gf , \alpha ) }"']
		&&
		( c \in A , z \in X_c )
	\end{tikzcd}
	\]
	where
	\[
		X \xrightarrow{ \varphi } f^* ( y ) \xrightarrow{ f^* ( \psi ) } f^* ( g^* ( z )) \xrightarrow{ \mu } ( gf )^*( z )
	\] 
	and $ \alpha = \mu \circ f^*(\psi ) \circ \varphi $.
\end{defi}

We need to verify that the composition law is associative and unital.
For the identity morphisms it holds that 
\[
	( a \in A , x \in X_a ) \xrightarrow{ ( \id_a , x \xrightarrow{ \epsilon } \id^* ( x ) ) } ( a \in A , x \in X_a ) 
\] 
where 
\[
	\epsilon_a \colon \id_{X_a } \Rightarrow X ( \id_a ) = ( \id_a )^*.
\]

\begin{thm}
	The functor $ \int^A \colon \twoFun ( A^{ \op } , \underline{\Cat } ) \to \Cat /A $ is fully faithful, with essential image the Grothendieck fibrations.
\end{thm}

\begin{exmp}
	Take the functor from $ \Ring $ to $ \Cat $ that takes a ring $ R $ to its module category, we have the following commutative diagram
	\[
	\begin{tikzcd}
		R 
		\ar[r, mapsto]
		\ar[d, "f"]
		&
		\Mod_R
		\ar[d, bend left=60, dashed, " f_! = - \otimes_k S "]
		\ar[d, bend right=70, dashed, " f_* "' ]
		\ar[d, bend left, phantom, " \vdash "]
		\ar[d, bend right=55, phantom, " \vdash "']
		\\ 
		S 
		\ar[r, mapsto]
		&
		\Mod_S
		\ar[u, " f^* "]
	\end{tikzcd}
	\]
\end{exmp}

Let $ X \colon A^{ \op } \to \underline{ \Cat } $ be a 2-functor and $ A $ a small 1-category, as well as $ \underline{ \Cat } $ the strict 2-category of categories.
 
\begin{prop}
	The Grothendieck Construction $ \int^A X $ is a 1-category.
\end{prop}

\begin{proof}
	Consider for the Unitality
	\[
	\begin{tikzcd}
		( a \in A , x \in X_a )
		\ar[rrr, " { ( \id_a , x \xrightarrow{ \epsilon_a } ( \id_a )^* ( x ) ) } " ]
		\ar[rrrd, " h "' ]
		&&&
		( a \in A , x \in X_a )
		\ar[d, " { ( a \xrightarrow{ f } c , x \xrightarrow{ \varphi } f^* ( y ) ) } " ]
		\\
		&&&
		( c \in A , z \in X_c )
	\end{tikzcd}
	\]
	where
	$
	\begin{tikzcd}		
		a
		\ar[r, " \id_* "]
		\ar[rr, bend right, " f "' ]
		&
		a
		\ar[r, " f " ]
		&
		b , x
		\ar[r, " \alpha " ]
		&
		f^* ( y ).
	\end{tikzcd} 
	$
	\[
	\begin{tikzcd}
		( \id_a )^*
		&
		( \id_a )^* ( x )
		\ar[r , " ( \id_a )^* ( \varphi ) "]
		&
		( \id_a )^* ( f^* ( y ) )
		\ar[r, " \mu " , " \sim "']
		&
		( f \circ \id_a )^* ( y ) = f^* ( y )
		\\
		\mathds{ 1 }_{ X_a }
		\ar[ u , Rightarrow, " \epsilon_a " ]
		&
		X
		\ar[u, " ( \epsilon_a )_* "]
		\ar[r, " \varphi " ]
		&
		f^* ( y ) 
		\ar[u, " { ( \epsilon_a )_{ f^* y } } " ]
		\ar[ru, " \id_{ f^* ( y ) } "' ]
	\end{tikzcd}
	\]
	The right triangle commutes by the definition of $ \epsilon $ and the square by the naturality of $ \epsilon_a $ .
	Now for the associativity take the following diagram:
	\[
	\begin{tikzcd}	
		( a \in A , s \in X_a ) 
		\ar[r, " { ( f , u ) } " ]
		\ar[rd, " { ( g \circ f , \mu \circ f^* ( v ) \circ u ) } "' ]
		&
		( b \in A , x \in X_b )
		\ar[d, " {  ( g , v ) } "]
		\ar[rd, " { (  h g , \mu \cdot g^* ( v ) \circ u ) } " ]
		\\
		&
		( c \in A , y \in X_c )
		\ar[r , " { ( h , w ) } "]
		&
		( d \in A , z \in X_d )
	\end{tikzcd}
	\]
	The outer two compositions are given by
	\[
	\begin{tikzcd}		
		( a \in A , s \in X_a )
		\ar[rr, bend left, "{ ( hgf , \mu \circ f^* ( \mu g^* ( w ) \circ v ) \circ u )}"]
		\ar[rr, bend right, "{ ( hgf, \mu \circ ( gf )^* ( w ) \circ \mu f^* ( v ) \circ u ) } "']
		&&
		( d \in A , z \in X_d )
	\end{tikzcd}
	\]
	Let us examine these compositions in detail, we have
	\[
		a \xrightarrow{f} b \xrightarrow{g} c \xrightarrow{h} d
	\]
	in $ A $
	and morphisms $ s \xrightarrow{u} f^* ( x ) , x \xrightarrow{v} g^* ( y ) , y \xrightarrow{w} h^* ( z ) $, put together we get the commutative diagram
	\[
	\begin{tikzcd}
		s 
		\ar[r, " u "]
		&
		f^* ( x ) 
		\ar[r, " f^* ( v ) "]
		&
		f^* ( g^* ( y ) )
		\ar[r," \mu "]
		\ar[d," f^* ( g^* ( w )) "]
		&
		( g \circ f )^* ( y ) 
		\ar[d, " { ( g \circ f )*(w) } "]
		\\
		&&
		f^* ( g^* ( h^* ( z )))
		\ar[r, " \mu "]
		\ar[d," f^* ( \mu ) "]
		&
		( gf )^* (h^* ( z ))
		\ar[d, " \mu "]
		\\
		&&
		f^* (( h g )^*( z ) )
		\ar[r, "\mu"]
		&
		( g f h )^* ( z ) 
	\end{tikzcd}
	\]
	Since the squares commute by the associativity constraint, we get that both compositions are equal and thus the associativity constraint holds.
\end{proof}

\begin{defi}
\label{p-cartesian_defi}
	A morphism $ \varphi \colon Y \to X $ is called p-cartesian if $ \forall g ,  \exists! \rho $ such that 
	\[
	\begin{tikzcd}
		&
		Y
		\ar[rd, " \varphi " ]
		\\
		Z
		\ar[ru, dashed, " \exists! \rho "]
		\ar[rr, " \forall \psi" ]
		&&
		X
	\end{tikzcd}
	\xmapsto{ p }
	\begin{tikzcd}
		&
		p ( Y ) = a 
		\ar[rd, " f = p ( \rho ) " ]
		\\
		p ( Z ) = a'
		\ar[ru, " \forall g "]
		\ar[rr, " h = p ( X ) "' ]
		&&
		b = p ( X ) 
	\end{tikzcd}
	\]
	or equivalently if the following lift exists
	\[
	\begin{tikzcd}	
		\{ 1 \to 2 \}
		\ar[r, hook, " i " ]
		&
		\lambda^2_2
		\ar[r, " F "]
		\ar[d]
		&
		\mathcal{ X }
		\ar[d, " p "]
		\\
		&
		\Delta^2
		\ar[ru, dashed, "\exists ! "]
		\ar[r, " \forall G "]
		&
		A
	\end{tikzcd}
	\]
	where $ F ( i ( 1 \to 2 ) ) = \varphi $.
\end{defi}

\begin{defi}
	A functor of 1-categories $ \mathcal{ X } \xrightarrow{ p } A $ is a Grothendieck fibration.
	If $ \forall X \in \mathcal{ X } , \forall a \xrightarrow{ f } b = p ( X ) $ there exists a morphism $ Y \xrightarrow{ \varphi } X $ in $ \mathcal{ X } $ that is p-cartesian such that $ p ( \varphi ) = f $.
\end{defi}

\begin{defi}
	Let $ \mathcal{ C } $ be a category. 
	A lifitng problem in $ \mathcal{ C } $ is a commutative square 
	\[
	\begin{tikzcd}
		A
		\ar[r, "f"]
		\ar[d, "i"]
		&
		X 
		\ar[d, "p"]
		\\
		B
		\ar[r, "g"]
		&
		Y
	\end{tikzcd}	
	\]
	in $ \mathcal{ C } $. 
	A solution to the lifting problem (a lift) is a morphism $ h \colon B \to X $ such that $ ph = q, h \circ i = f $.
\end{defi}

\begin{prop}
	The functor $ \int^A X \xrightarrow{ p } A $ is a Grothendieck fibration.
\end{prop} 

\begin{proof}
	Let $ Z = ( c \in A , z \in X_c ) \in \int^A_X $ be an object and $g \colon b \to p ( z ) = c $ in $ A $ be a morphism in $ A $, then $ g^* \colon X_c \to X_b $ and $ z \mapsto g^* ( z ) $.
	Consider 
	\[
		\psi \coloneqq ( b \in A , g^* ( z ) \in X_b ) 
		\xrightarrow{(g , g^* ( z ) \xrightarrow{\id} g^* ( z ) )}
		( c \in A , z \in X_c ) = X 
	\]
	\underline{Claim}: $ \psi $ is p-cartesian.
	Take a diagram
	\[
	\begin{tikzcd}
		& 
		b
		\ar[rd, " { g = p ( \psi ) }"]
		\\
		a
		\ar[ru, " \forall f "]
		\ar[rr, " { h = p ( \alpha ) }"']
		&&
		c
	\end{tikzcd}
	\]
	the associated lifting problem is
	\[
	\begin{tikzcd}
		&
		( b \in A , g^* ( z ) \in X_b )
		\ar[rd, "{ ( g , \id_{ g^* ( z ) } = \psi ) }" ] 	
		\\
		( a \in A , x \in X_a )
		\ar[rr, " {\forall ( h , x \isomorphism h^* ( z ) ) = \alpha } "' ]
		\ar[ru, dashed , " { ( f , x \xrightarrow{ u } f^* ( g^* ( z ) ) ) } "]
		&&
		( c \in A , z \in X_c )
	\end{tikzcd}
	\]
	In order for the lifting diagram to commute, we need to construct $ u $ as follows.
	We have the composition
	\begin{align*}
		x \xrightarrow{ u } f^* ( g^* ( z ) ) \xrightarrow{ f^* ( \id_{ g^* } ) } f^* ( g^* ( z ) ) \xrightarrow{ \mu } ( gf )^* ( z )
		\\
		= x \xrightarrow{v} ( g f )^* ( z )  
	\end{align*}
	thus taking $ u = \mu^{ - 1 } \circ v $ works.
\end{proof}


\begin{defi}
\label{isofibration}
	The functor $ \mathcal{ X } \xrightarrow{p} A $ is called an \textbf{isofibration}
	if $ \forall f \colon a \isomorphism p ( x ) = b $ there exists $ Y \xrightarrow{\varphi} X $ an isomorphism in $ \mathcal{ X } $ such that $ p ( \varphi ) = f $.
	That is if there exists a solution to the following lifting problem:
	\[
	\begin{tikzcd}
		\Lambda_0^0
		\ar[r, " x "]
		\ar[d]
		& 
		\mathcal{ X }
		\ar[d, " p "]
		\\
		\Delta^1
		\ar[ru, dashed, " \exists \varphi"]
		\ar[r, " a \xrightarrow{f} p ( x ) "']
		&
		A
	\end{tikzcd}
	\]
\end{defi}

\begin{lem}
	If $ p \colon \mathcal{ X } \to A $ is a Grothendieck fibration then $ p $ is an isofibration.
\end{lem}

\begin{proof}
	Let $ x \in \mathcal{ X } $ and $ f \colon a \isomorphism p ( x ) = b $ an isomorphism in $ A $.
	Choose a p-cartesian lift of $ f $, $ \varphi \colon Y \to X $ in $ \mathcal{ X } $ take a diagram 
	\[
	\begin{tikzcd}
		&
		Y
		\ar[rd, " \varphi "]
		\\
		X
		\ar[ru, dashed, " \exists ! \psi "]
		\ar[rr, " \id_* "']
		&&
		X
	\end{tikzcd}
	\]
	where $ \varphi \circ \psi = \id_x $ and $ p ( \psi ) = g = f^{-1} $, which means we have the following diagram: 
	\[
	\begin{tikzcd}
		&
		a 
		\ar[rd, " f "]
		\\
		b
		\ar[ru, " f^{ - 1 } = g "]
		\ar[rr, " \id_b"']
		&&
		b = p ( x )
	\end{tikzcd}	
	\]
	The following equalities hold 
	\begin{align*}
		\varphi \circ ( \psi \circ \varphi ) = ( \varphi \circ \psi ) \circ \varphi = \varphi \circ \id_x = \varphi 
	\end{align*}
	now since $ p ( \psi ) \circ p ( \varphi ) =  f^{ - 1 } \circ f = \id_a $
	we get by the uniqueness of lifts that $ \psi \circ \varphi = \id_Y $.
	Thus we found a lift that is an isomorphism, which proves the claim.
\end{proof}

Let now $ \mathcal{ X } \xrightarrow{ p } A $ be a Grothendieck fibration and $ X \colon A^{ \op } \to \underline{\Cat} $ a 2-functor
defined by sending each object  $ a $ of $ A $ to the two-pullback $ \mathcal{ X }_a $ along the object $ a $ and $ p \colon \mathcal{ X } \to A $, that is,
\[
\begin{tikzcd}		
	\mathcal{X}_a 
	\ar[r]
	\ar[d]
	&
	\mathcal{X}
	\ar[d,"p"]
	\\
	\mathds{1}
	\ar[r,"a"]
	&
	A
\end{tikzcd}
\]
now for any morphism $ f \colon a \to b $ we obtain a functor $ f^* \colon \mathcal{ X }_b \to \mathcal{ X }_a $.
Let $ x \in \mathcal{ X }_b \xrightarrow{ f^* } \mathcal{ X }_a $
and $ \varphi \colon f^* ( x ) \to x $ in $ \mathcal{X} $ (notice the slight abuse of notation when we identify an object in the fiber with its image in $ \mathcal{ X } $) so that $ p ( \varphi ) = f $.

